{"version":3,"sources":["story/ChoiceNode.module.css","LoadingScreen.module.css","akun.js","spiral.svg","LoadingScreen.jsx","utils/formatImageUrl.js","navBar/NavBarStory.jsx","navBar/NavBarStoryInfo.jsx","navBar/NavBar.jsx","chat/ChatHeader.jsx","utils/formatDate.js","chat/ChatNode.jsx","chat/ChatHistory.jsx","chat/ChatInput.jsx","chat/Chat.jsx","story/ChapterNode.jsx","story/ChoiceNode.jsx","story/ReaderPostNode.jsx","story/TagList.jsx","story/StoryHeader.jsx","story/Story.jsx","story/StoryControls.jsx","story/StoryView.jsx","App.jsx","serviceWorker.js","index.js"],"names":["module","exports","akun","Akun","protocol","hostname","connection","window","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","transform","fill","stroke","d","_ref","svgRef","title","props","width","height","viewBox","preserveAspectRatio","ref","ForwardRef","forwardRef","cx","classnames","bind","styles","LoadingScreen","className","backdrop","centerPadding","verticalCenter","content","spiral","a","tagLine","formatImageUrl","url","options","crop","newUrl","URL","host","endsWith","fileNameMatch","pathname","match","Error","fileName","search","searchParams","append","console","warn","toString","NavBarStory","data","showStory","onMouseEnter","onMouseLeave","coverUrl","Array","isArray","shortName","join","getShortName","t","shortNameClass","onClick","_id","e","currentTarget","offsetTop","src","alt","NavBarStoryInfo","story","position","style","top","dangerouslySetInnerHTML","__html","initialState","storyPosition","scrollTop","reducer","state","undefined","NavBar","liveStories","contentRef","useRef","useReducer","dispatch","onScroll","current","map","ChatHeader","client","useState","chatThread","usersCount","setUsersCount","useEffect","onChatUsersCount","on","off","formatDate","date","toLocaleString","NodeOwner","node","userId","username","avatarUrl","avatar","href","ChatNode","onImageLoad","onImageLoadError","Date","createdTime","onLoad","onError","body","split","line","lineIndex","greenText","charAt","delimiter","Math","random","replace","$0","fragment","fragmentIndex","test","err","log","color","processBody","ChatHistory","historyRef","messageEndRef","history","nodes","setNodes","scrollOnUpdate","setScrollOnUpdate","scrollToBottom","scrollIntoView","onChatChat","slice","onChatChatUpdated","scrollHeight","clientHeight","id","textarea","field","value","ChatInput","postChat","chatInputRef","tryPost","onSubmit","preventDefault","name","placeholder","rows","onKeyDown","altKey","shiftKey","ctrlKey","onChange","Chat","ChapterNode","innerHTML","$1","$2","$3","Choice","choice","choiceNodeId","startsSelected","selectedState","setSelected","xOut","removeVote","choiceId","then","catch","vote","xOutReason","count","countVerified","ChoiceNode","voterCount","visibleChoices","choices","filter","availableChoices","crossedOutChoices","forEach","push","header","closed","closedState","open","table","countHeader","concat","Dice","dice","Vote","ReaderPostNode","postCountText","diceRollerIds","voterIds","votes","postCount","_","uniq","diceRollerId","voterId","includes","TagList","tags","spoilerTags","tag","Author","user","n","StoryHeader","metaData","u","ta","Story","storyThread","setMetaData","onChapter","onChapterUpdated","onChoice","onChoiceUpdated","onReaderPost","onReaderPostUpdated","onMetaData","unrecognisedKey","type","StoryControls","StoryView","App","initPhase","clientChatFreshEntry","init","Promise","all","ephemeralUserIdPromise","joinPinnedStories","updateLiveStories","setState","getStories","stories","React","Component","Boolean","location","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.e35ad57a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"node\":\"ChoiceNode_node__2iCfm\",\"header\":\"ChoiceNode_header__RtUqj\",\"title\":\"ChoiceNode_title__hVC-b\",\"closedState\":\"ChoiceNode_closedState__158Fe\",\"count\":\"ChoiceNode_count__yWLEJ\",\"date\":\"ChoiceNode_date__3aWCu\",\"body\":\"ChoiceNode_body__3GK0y\",\"table\":\"ChoiceNode_table__1dpyi\",\"open\":\"ChoiceNode_open__3D_Cr\",\"choice\":\"ChoiceNode_choice__14TtS\",\"unselected\":\"ChoiceNode_unselected__2AVEJ\",\"selected\":\"ChoiceNode_selected__2uEqM\",\"pending\":\"ChoiceNode_pending__3Ta0Y\",\"xOut\":\"ChoiceNode_xOut__3fa5X\",\"countHeader\":\"ChoiceNode_countHeader__1fCP8\",\"vote\":\"ChoiceNode_vote__1korm\",\"value\":\"ChoiceNode_value__3rE0n\",\"xOutReason\":\"ChoiceNode_xOutReason__2wNhD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"backdrop\":\"LoadingScreen_backdrop__33_hS\",\"verticalCenter\":\"LoadingScreen_verticalCenter__3N_6G\",\"centerPadding\":\"LoadingScreen_centerPadding__1jDA0\",\"content\":\"LoadingScreen_content__Zr6FU\",\"spiral\":\"LoadingScreen_spiral__3s1-M\",\"spiral1\":\"LoadingScreen_spiral1__3jnQZ\",\"spin1\":\"LoadingScreen_spin1__3dTYc\",\"spiral2\":\"LoadingScreen_spiral2__QXFn8\",\"spin2\":\"LoadingScreen_spin2__35kI8\",\"spiral3\":\"LoadingScreen_spiral3__O53Hl\",\"spin3\":\"LoadingScreen_spin3__ZpOol\",\"a\":\"LoadingScreen_a__3zapJ\",\"tagLine\":\"LoadingScreen_tagLine__3S2JJ\"};","import Akun from 'akun-api';\r\n\r\nconst akun = new Akun({\r\n\tprotocol: 'http:',\r\n\thostname: 'localhost:5050',\r\n\tconnection: {\r\n\t\thostname: 'rt.fiction.live'\r\n\t}\r\n});\r\nwindow.akun = akun; // make debugging easier\r\n\r\nexport default akun;\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  transform: \"translate(370.000000,370.000000) scale(-0.100000,-0.100000)\",\n  fill: \"#000000\",\n  stroke: \"none\"\n}, React.createElement(\"path\", {\n  d: \"M1825 3524 c-165 -34 -259 -70 -367 -139 -442 -286 -557 -875 -257 -1312 43 -62 160 -179 223 -223 33 -22 45 -35 35 -38 -7 -3 -16 -8 -19 -12 -3 -4 -54 -15 -114 -24 -93 -15 -121 -16 -190 -6 -200 29 -337 94 -475 224 -188 179 -273 476 -210 744 9 42 16 78 15 79 -6 7 -81 -160 -103 -227 -99 -313 -13 -675 217 -909 82 -83 90 -90 170 -142 125 -81 262 -127 412 -137 180 -12 326 11 466 74 29 13 55 24 57 24 19 0 -19 -121 -65 -212 -91 -179 -264 -322 -470 -389 -86 -28 -254 -36 -366 -19 -47 7 -87 17 -90 22 -3 4 -12 8 -21 8 -48 0 -229 113 -306 191 -38 39 -54 50 -41 27 90 -154 199 -269 339 -355 63 -39 151 -80 190 -88 17 -4 41 -11 55 -16 109 -39 360 -35 495 8 127 40 271 119 355 195 38 34 136 152 167 200 75 117 132 296 145 457 l3 34 54 -54 c149 -151 224 -334 224 -549 0 -178 -45 -321 -147 -463 -101 -143 -212 -219 -416 -288 l-85 -29 95 5 c419 25 737 279 852 681 31 107 33 352 4 458 -57 211 -178 393 -345 518 -31 23 -60 45 -65 49 -11 9 23 27 71 36 21 5 108 8 193 7 172 -1 220 -12 349 -81 89 -47 126 -76 199 -152 102 -106 186 -269 207 -398 21 -126 8 -290 -30 -398 -14 -38 24 20 60 93 87 177 110 427 59 632 -21 83 -105 256 -153 318 -67 84 -152 164 -226 213 -63 42 -111 66 -228 113 -65 26 -252 49 -342 42 -143 -12 -270 -46 -363 -98 -42 -23 -43 -23 -38 7 21 117 107 272 204 370 75 76 174 147 234 167 18 6 38 14 43 19 6 4 48 17 95 29 92 23 302 30 337 12 10 -6 35 -13 55 -16 104 -16 237 -92 347 -198 l65 -63 -29 50 c-16 28 -35 56 -42 63 -7 7 -13 18 -13 23 0 12 -175 188 -205 207 -114 71 -160 95 -225 117 -3 1 -12 4 -20 8 -65 26 -151 40 -260 44 -125 5 -191 -2 -285 -30 -27 -7 -57 -16 -65 -18 -51 -14 -216 -109 -278 -160 -181 -149 -308 -387 -329 -616 -3 -35 -9 -63 -13 -63 -15 0 -109 110 -145 170 -170 280 -149 649 52 897 113 139 240 224 411 273 l67 19 -80 -1 c-44 0 -89 -2 -100 -4z\"\n}));\n\nvar SvgSpiral = function SvgSpiral(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    width: \"370.000000pt\",\n    height: \"370.000000pt\",\n    viewBox: \"0 0 370.000000 370.000000\",\n    preserveAspectRatio: \"xMidYMid meet\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgSpiral, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/spiral.59831f55.svg\";\nexport { ForwardRef as ReactComponent };","import classnames from 'classnames/bind';\r\nimport React from 'react';\r\nimport styles from './LoadingScreen.module.css';\r\nimport {ReactComponent as Spiral} from './spiral.svg';\r\n\r\nconst cx = classnames.bind(styles);\r\n\r\nexport default function LoadingScreen() {\r\n\treturn (\r\n\t\t<div className={styles.backdrop}>\r\n\t\t\t<div className={styles.centerPadding}/>\r\n\t\t\t<div className={styles.verticalCenter}>\r\n\t\t\t\t<div className={styles.centerPadding}/>\r\n\t\t\t\t<div className={styles.content}>\r\n\t\t\t\t\t<Spiral className={cx(styles.spiral, 'spiral1')}/>\r\n\t\t\t\t\t<Spiral className={cx(styles.spiral, 'spiral2')}/>\r\n\t\t\t\t\t<Spiral className={cx(styles.spiral, 'spiral3')}/>\r\n\t\t\t\t\t<div className={styles.a}>A</div>\r\n\t\t\t\t\t<div className={styles.tagLine}>Crawling through the portal...</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={styles.centerPadding}/>\r\n\t\t\t</div>\r\n\t\t\t<div className={styles.centerPadding}/>\r\n\t\t</div>\r\n\t);\r\n}\r\n","export default function formatImageUrl(url, options) {\r\n\tconst width = options && options.width;\r\n\tconst height = (options && options.width) ?? width;\r\n\tconst crop = (options && options.crop) ?? true;\r\n\r\n\tconst newUrl = new URL(url);\r\n\tswitch (true) {\r\n\t\tcase newUrl.host.endsWith('filepicker.io'): {\r\n\t\t\tconst fileNameMatch = newUrl.pathname.match(/^\\/api\\/file\\/([\\w.-]+?)(?:\\/convert)?$/);\r\n\t\t\tif (!fileNameMatch) {\r\n\t\t\t\tthrow new Error(`Couldn't parse image url: ${url}`);\r\n\t\t\t}\r\n\t\t\tconst fileName = fileNameMatch[1];\r\n\t\t\tnewUrl.search = '';\r\n\t\t\tif (options) {\r\n\t\t\t\tnewUrl.pathname = `/api/file/${fileName}/convert`;\r\n\t\t\t\tnewUrl.searchParams.append('h', height);\r\n\t\t\t\tnewUrl.searchParams.append('w', width);\r\n\t\t\t\tnewUrl.searchParams.append('fit', crop ? 'crop' : 'max');\r\n\t\t\t} else {\r\n\t\t\t\tnewUrl.pathname = `/api/file/${fileName}`;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\tbreak;\r\n\t\tcase newUrl.host.endsWith('.cloudfront.net'): {\r\n\t\t\tnewUrl.host = 'cdn.fiction.live';\r\n\t\t\tconst fileNameMatch = newUrl.pathname.match(/^\\/images\\/([\\w.-]+?)$/);\r\n\t\t\tif (!fileNameMatch) {\r\n\t\t\t\tthrow new Error(`Couldn't parse image url: ${url}`);\r\n\t\t\t}\r\n\t\t\tconst fileName = fileNameMatch[1];\r\n\t\t\tnewUrl.search = '';\r\n\t\t\tif (options) {\r\n\t\t\t\t// @see https://github.com/tripviss/image-resizer\r\n\t\t\t\tif (crop) {\r\n\t\t\t\t\tnewUrl.pathname = `/h${height}-w${width}-cfill/images/${fileName}`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewUrl.pathname = `/h${height}-w${width}/images/${fileName}`;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnewUrl.pathname = `/images/${fileName}`;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tconsole.warn(`Couldn't parse image url: ${url}`);\r\n\t\t\treturn url;\r\n\t}\r\n\r\n\treturn newUrl.toString();\r\n}\r\n","import React from 'react';\r\nimport formatImageUrl from '../utils/formatImageUrl.js';\r\nimport './NavBarStory.css';\r\n\r\nfunction getShortName(title) {\r\n\tconst match = title.match(/\\b[A-z:']/g);\r\n\tif (!match) {\r\n\t\tconsole.warn(`Could not derive short name for ${title}`);\r\n\t\treturn 'X';\r\n\t}\r\n\treturn match.join('');\r\n}\r\n\r\nexport default function NavBarStory({ data, showStory, onMouseEnter, onMouseLeave }) {\r\n\tconst options = {\r\n\t\twidth: 64,\r\n\t\theight: 64,\r\n\t\tcrop: true\r\n\t};\r\n\tlet coverUrl = null;//`https://placekitten.com/${options.width}/${options.height}`;\r\n\tif (data.i) {\r\n\t\tif (Array.isArray(data.i)) {\r\n\t\t\tcoverUrl = formatImageUrl(data.i[0], options);\r\n\t\t} else {\r\n\t\t\tcoverUrl = formatImageUrl(data.i, options);\r\n\t\t}\r\n\t}\r\n\tconst onClick = () => {\r\n\t\tshowStory(data._id);\r\n\t};\r\n\tconst shortName = getShortName(data.t);\r\n\tlet shortNameClass = 'short-name-large';\r\n\tif (shortName.length > 3) {\r\n\t\tshortNameClass = 'short-name-medium';\r\n\t}\r\n\tif (shortName.length > 5) {\r\n\t\tshortNameClass = 'short-name-small';\r\n\t}\r\n\treturn (\r\n\t\t<div className=\"nav-bar-story\"\r\n\t\t\t onClick={onClick}\r\n\t\t\t onMouseEnter={(e) => {\r\n\t\t\t\t onMouseEnter(data, e.currentTarget.offsetTop);\r\n\t\t\t }}\r\n\t\t\t onMouseLeave={() => {\r\n\t\t\t\t onMouseLeave(data);\r\n\t\t\t }}\r\n\t\t>\r\n\t\t\t<div className={`short-name ${shortNameClass}`}>{shortName}</div>\r\n\t\t\t{coverUrl && <img src={coverUrl} alt=\"\" className=\"icon\"/>}\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React from 'react';\r\nimport './NavBarStoryInfo.css';\r\n\r\nexport default function NavBarStoryInfo({ story, position }) {\r\n\treturn (\r\n\t\t<div className=\"nav-bar-story-info\" style={{ top: `${position}px` }}>\r\n\t\t\t<div className=\"pointer\"/>\r\n\t\t\t<div className=\"content\">\r\n\t\t\t\t<div dangerouslySetInnerHTML={{ __html: story.t }}/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, {useReducer, useRef} from 'react';\r\nimport './NavBar.css';\r\nimport NavBarStory from './NavBarStory.jsx';\r\nimport NavBarStoryInfo from './NavBarStoryInfo.jsx';\r\n\r\nconst initialState = { story: null, storyPosition: 0, scrollTop: 0 };\r\n\r\nfunction reducer(state, { story, storyPosition, scrollTop }) {\r\n\treturn {\r\n\t\tstory: story === undefined ? state.story : story,\r\n\t\tstoryPosition: storyPosition ?? state.storyPosition,\r\n\t\tscrollTop: scrollTop ?? state.scrollTop\r\n\t};\r\n}\r\n\r\nexport default function NavBar({ liveStories, showStory }) {\r\n\tconst contentRef = useRef(null);\r\n\r\n\tconst [state, dispatch] = useReducer(reducer, initialState);\r\n\r\n\tconst onMouseEnter = (story, position) => {\r\n\t\tdispatch({ story, storyPosition: position });\r\n\t};\r\n\r\n\tconst onMouseLeave = (story) => {\r\n\t\tif (story === state.story) {\r\n\t\t\tdispatch({ story: null });\r\n\t\t}\r\n\t};\r\n\r\n\tconst onScroll = () => {\r\n\t\tdispatch({ scrollTop: contentRef.current.scrollTop });\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"nav-bar\">\r\n\t\t\t\t<div className=\"content\" ref={contentRef} onScroll={onScroll}>\r\n\t\t\t\t\t{liveStories.map((story) => {\r\n\t\t\t\t\t\treturn (<NavBarStory\r\n\t\t\t\t\t\t\tkey={story._id}\r\n\t\t\t\t\t\t\tdata={story}\r\n\t\t\t\t\t\t\tshowStory={showStory}\r\n\t\t\t\t\t\t\tonMouseEnter={onMouseEnter}\r\n\t\t\t\t\t\t\tonMouseLeave={onMouseLeave}\r\n\t\t\t\t\t\t/>);\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"nav-bar-overlay\">\r\n\t\t\t\t{state.story && (\r\n\t\t\t\t\t<NavBarStoryInfo story={state.story} position={state.storyPosition - state.scrollTop + 32}/>)}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","import React, {useEffect, useState} from 'react';\r\nimport './ChatHeader.css';\r\n\r\nexport default function ChatHeader({ client }) {\r\n\tconst [usersCount, setUsersCount] = useState(client.chatThread.usersCount);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst onChatUsersCount = (usersCount) => {\r\n\t\t\tsetUsersCount(usersCount);\r\n\t\t};\r\n\t\tclient.chatThread.on('usersCount', onChatUsersCount);\r\n\t\tsetUsersCount(client.chatThread.usersCount);\r\n\t\treturn () => {\r\n\t\t\tclient.chatThread.off('usersCount', onChatUsersCount);\r\n\t\t}\r\n\t}, [client]);\r\n\r\n\treturn (\r\n\t\t<div className=\"chat-header\">\r\n\t\t\t<div className=\"title\">Chat</div>\r\n\t\t\t<div className=\"user-count\">{usersCount} users</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","export default function formatDate(date) {\r\n\treturn date.toLocaleString();\r\n}\r\n","import React from 'react';\r\nimport './ChatNode.css';\r\nimport formatDate from '../utils/formatDate.js';\r\nimport formatImageUrl from '../utils/formatImageUrl.js';\r\n\r\nfunction NodeOwner({ node }) {\r\n\tif (node.userId) {\r\n\t\tif (node.username === 'Anon') {\r\n\t\t\treturn (<span className=\"username\">{node.username} ({node.userId})</span>);\r\n\t\t} else {\r\n\t\t\tconst avatarUrl = node.avatar && formatImageUrl(node.avatar, { width: 16, height: 16 });\r\n\t\t\treturn (<a href={`https://fiction.live/user/${node.username}`}>\r\n\t\t\t\t\t{avatarUrl ? (<img alt=\"\" className=\"avatar\" src={avatarUrl}/>) : null}\r\n\t\t\t\t\t<span className=\"username\">{node.username}</span>\r\n\t\t\t\t</a>\r\n\t\t\t);\r\n\t\t}\r\n\t} else {\r\n\t\treturn (<span className=\"username\">{node.username}</span>);\r\n\t}\r\n\r\n}\r\n\r\nfunction processBody(body) {\r\n\ttry {\r\n\t\treturn body.toString().split('\\n').map((line, lineIndex) => {\r\n\t\t\tlet greenText = line.charAt(0) === '>';\r\n\t\t\t// TODO find a better way of doing this\r\n\t\t\tconst delimiter = `some-dumb-string-nobody-would-use-${Math.random()}`;\r\n\t\t\tconst content = line.replace(/https?:\\/\\/\\S+/ig, ($0) => {\r\n\t\t\t\treturn `${delimiter}${$0}${delimiter}`;\r\n\t\t\t}).split(delimiter).map((fragment, fragmentIndex) => {\r\n\t\t\t\treturn /https?:\\/\\/\\S+/i.test(fragment) ? (\r\n\t\t\t\t\t<a key={fragmentIndex + fragment} href={fragment}>{fragment}</a>) : fragment;\r\n\t\t\t});\r\n\t\t\t// TODO the key usage here is cursed\r\n\t\t\treturn (<div key={lineIndex + line} className={greenText ? \"green-text\" : \"\"}>{content}</div>);\r\n\t\t\t// return greenText ? (<div className=\"green-text\">{content}</div>) : (<div>{content}</div>);\r\n\t\t});\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\treturn <div style={{ color: 'red' }}> {err.toString()}</div>;\r\n\t}\r\n}\r\n\r\nexport default function ChatNode({ node, onImageLoad, onImageLoadError }) {\r\n\treturn (\r\n\t\t<div className=\"chat-node\">\r\n\t\t\t<div className=\"info\">\r\n\t\t\t\t<NodeOwner node={node}/>\r\n\t\t\t\t<span className=\"date\">{formatDate(new Date(node.createdTime))}</span>\r\n\t\t\t</div>\r\n\t\t\t{node.data.i && (<img\r\n\t\t\t\talt=\"[failed to load]\"\r\n\t\t\t\tclassName=\"image\"\r\n\t\t\t\tsrc={formatImageUrl(node.data.i)}\r\n\t\t\t\tonLoad={onImageLoad}\r\n\t\t\t\tonError={onImageLoadError}\r\n\t\t\t/>)}\r\n\t\t\t{node.body && (<div className=\"body\">{processBody(node.body)}</div>)}\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, {useEffect, useRef, useState} from 'react';\r\nimport './ChatHistory.css';\r\nimport ChatNode from './ChatNode.jsx';\r\n\r\nexport default function ChatHistory({ client }) {\r\n\tconst historyRef = useRef(null);\r\n\tconst messageEndRef = useRef(null);\r\n\r\n\tconst [nodes, setNodes] = useState(client.chatThread.history.nodes);\r\n\tconst [scrollOnUpdate, setScrollOnUpdate] = useState(true);\r\n\r\n\tconst scrollToBottom = () => {\r\n\t\tif (!scrollOnUpdate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tmessageEndRef.current.scrollIntoView();\r\n\t};\r\n\r\n\tconst onImageLoad = () => {\r\n\t\tscrollToBottom();\r\n\t};\r\n\r\n\tconst onImageLoadError = () => {\r\n\t\tscrollToBottom();\r\n\t};\r\n\r\n\tconst onScroll = () => {\r\n\t\t// if (!state.nodes?.length) {\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\tconst { scrollHeight, scrollTop, clientHeight } = historyRef.current;\r\n\t\tconst distanceFromBottom = scrollHeight - clientHeight - scrollTop;\r\n\t\t// const finalNode = messageEndRef.current.previousElementSibling;\r\n\t\t// const penultimateNode = finalNode.previousElementSibling;\r\n\t\tconst threshold = 0; // finalNode.clientHeight + (penultimateNode ? penultimateNode.clientHeight : 0);\r\n\t\tsetScrollOnUpdate(distanceFromBottom <= threshold);\r\n\t};\r\n\r\n\tuseEffect(scrollToBottom);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst onChatChat = () => {\r\n\t\t\tsetNodes(client.chatThread.history.nodes.slice());\r\n\t\t};\r\n\t\tconst onChatChatUpdated = () => {\r\n\t\t\tsetNodes(client.chatThread.history.nodes.slice());\r\n\t\t};\r\n\t\tclient.chatThread.on('chat', onChatChat);\r\n\t\tclient.chatThread.on('chatUpdated', onChatChatUpdated);\r\n\r\n\t\tsetScrollOnUpdate(true);\r\n\t\tsetNodes(client.chatThread.history.nodes.slice());\r\n\t\treturn () => {\r\n\t\t\tclient.chatThread.off('chat', onChatChat);\r\n\t\t\tclient.chatThread.off('chatUpdated', onChatChatUpdated);\r\n\t\t}\r\n\t}, [client]);\r\n\r\n\treturn (\r\n\t\t<div className=\"chat-history\" ref={historyRef} onScroll={onScroll}>\r\n\t\t\t{nodes?.map((node) => {\r\n\t\t\t\treturn <ChatNode\r\n\t\t\t\t\tkey={node.id}\r\n\t\t\t\t\tnode={node}\r\n\t\t\t\t\tonImageLoad={onImageLoad}\r\n\t\t\t\t\tonImageLoadError={onImageLoadError}\r\n\t\t\t\t/>\r\n\t\t\t})}\r\n\t\t\t<div ref={messageEndRef}/>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, {useEffect, useReducer, useRef} from 'react';\r\nimport './ChatInput.css';\r\n\r\nconst initialState = {\r\n\ttextarea: ''\r\n};\r\n\r\nfunction reducer(state, { field, value }) {\r\n\treturn {\r\n\t\t...state,\r\n\t\t[field]: value\r\n\t};\r\n}\r\n\r\nexport default function ChatInput({ postChat }) {\r\n\tconst chatInputRef = useRef(null);\r\n\r\n\tconst [state, dispatch] = useReducer(reducer, initialState);\r\n\r\n\tconst tryPost = () => {\r\n\t\tconst body = chatInputRef.current.value;\r\n\t\tif (body.length > 0) {\r\n\t\t\tdispatch({ field: 'textarea', value: '' });\r\n\t\t\tpostChat(body);\r\n\t\t}\r\n\t};\r\n\r\n\tconst onSubmit = (e) => {\r\n\t\te.preventDefault();\r\n\t\ttryPost();\r\n\t};\r\n\r\n\tconst onKeyDown = (e) => {\r\n\t\tif (e.key === 'Enter' && !e.altKey && !e.shiftKey && !e.ctrlKey) {\r\n\t\t\te.preventDefault();\r\n\t\t\ttryPost();\r\n\t\t}\r\n\t};\r\n\r\n\tconst onChange = (e) => {\r\n\t\tdispatch({ field: e.target.name, value: e.target.value });\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tconst textarea = chatInputRef.current;\r\n\t\ttextarea.style.height = 'inherit';\r\n\t\t// Why +2 ? Because without it the scrollbar is always visible\r\n\t\ttextarea.style.height = `${textarea.scrollHeight + 2}px`;\r\n\t});\r\n\r\n\treturn (\r\n\t\t<form className=\"chat-input\" onSubmit={onSubmit}>\r\n\t\t\t<textarea\r\n\t\t\t\tref={chatInputRef}\r\n\t\t\t\tname=\"textarea\"\r\n\t\t\t\tvalue={state.textarea}\r\n\t\t\t\tplaceholder=\"Message\"\r\n\t\t\t\trows=\"1\"\r\n\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\tonChange={onChange}\r\n\t\t\t/>\r\n\t\t\t{/*<button type=\"submit\">Submit</button>*/}\r\n\t\t</form>\r\n\t);\r\n}\r\n","import React from 'react';\r\nimport './Chat.css';\r\nimport ChatHeader from './ChatHeader.jsx';\r\nimport ChatHistory from './ChatHistory.jsx';\r\nimport ChatInput from './ChatInput.jsx';\r\n\r\nexport default function Chat({ client }) {\r\n\tconst postChat = client.postChat.bind(client);\r\n\r\n\treturn (\r\n\t\t<div className=\"chat\">\r\n\t\t\t<ChatHeader client={client}/>\r\n\t\t\t<ChatHistory client={client}/>\r\n\t\t\t<ChatInput postChat={postChat}/>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React from 'react';\r\nimport formatDate from '../utils/formatDate.js';\r\nimport formatImageUrl from '../utils/formatImageUrl.js';\r\nimport './ChapterNode.css';\r\n\r\nexport default function ChapterNode({ node }) {\r\n\tlet innerHTML = node.body;\r\n\tinnerHTML = innerHTML.replace(/(<img.*?src=\")(https?:\\/\\/[A-z0-9/.]+)(\".*?>)/g, ($0, $1, $2, $3) => {\r\n\t\treturn `${$1}${formatImageUrl($2)}${$3}`;\r\n\t});\r\n\treturn (\r\n\t\t<div className=\"chapter-node\">\r\n\t\t\t<div className=\"header\">\r\n\t\t\t\t<span className=\"title\"></span>\r\n\t\t\t\t<span className=\"date\">{formatDate(new Date(node.createdTime))}</span>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"body\" dangerouslySetInnerHTML={{ __html: innerHTML }}/>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import classnames from 'classnames/bind';\r\nimport React, {useState} from 'react';\r\nimport akun from '../akun.js';\r\nimport formatDate from '../utils/formatDate.js';\r\nimport styles from './ChoiceNode.module.css';\r\n\r\nconst cx = classnames.bind(styles);\r\n\r\nfunction Choice({ choice, choiceNodeId, startsSelected }) {\r\n\tconst [selectedState, setSelected] = useState(startsSelected);\r\n\r\n\tconst onClick = () => {\r\n\t\tswitch (selectedState) {\r\n\t\t\tcase 'pending':\r\n\t\t\t\treturn;\r\n\t\t\tcase 'selected':\r\n\t\t\t\takun.removeVote(choiceNodeId, choice.choiceId)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsetSelected('unselected');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(() => {\r\n\t\t\t\t\t\tsetSelected('selected');\r\n\t\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'unselected':\r\n\t\t\t\takun.vote(choiceNodeId, choice.choiceId)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsetSelected('selected');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(() => {\r\n\t\t\t\t\t\tsetSelected('unselected');\r\n\t\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn(`ChoiceNode in unexpected selectedState: ${selectedState}`);\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t\tsetSelected('pending');\r\n\t};\r\n\r\n\treturn (\r\n\t\t<tr className={cx('choice', selectedState, { xOut: choice.xOut })} onClick={onClick}>\r\n\t\t\t<td className={styles.vote}>\r\n\t\t\t\t<div className={styles.value}>{choice.value}</div>\r\n\t\t\t\t{choice.xOutReason && <div className={styles.xOutReason}>{choice.xOutReason}</div>}\r\n\t\t\t</td>\r\n\t\t\t<td className={styles.count}>{choice.countVerified}/{choice.count}</td>\r\n\t\t</tr>\r\n\t);\r\n}\r\n\r\nfunction getVoterCountText(voterCount) {\r\n\tlet voterCountText;\r\n\tif (voterCount > 1) {\r\n\t\tvoterCountText = `${voterCount} voters`;\r\n\t} else if (voterCount === 1) {\r\n\t\tvoterCountText = `1 voter`;\r\n\t} else {\r\n\t\tvoterCountText = `be the first to vote.`;\r\n\t}\r\n\treturn voterCountText;\r\n}\r\n\r\nexport default function ChoiceNode({ node }) {\r\n\r\n\tconst visibleChoices = node.choices.filter((choice) => !(choice.xOut && choice.value === 'permanentlyRemoved'));\r\n\tconst availableChoices = [];\r\n\tconst crossedOutChoices = [];\r\n\tvisibleChoices.forEach((choice) => {\r\n\t\tif (choice.xOut) {\r\n\t\t\tcrossedOutChoices.push(choice);\r\n\t\t} else {\r\n\t\t\tavailableChoices.push(choice);\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className={styles.node}>\r\n\t\t\t<div className={styles.header}>\r\n\t\t\t\t<span className={styles.title}>Choice -&nbsp;</span>\r\n\t\t\t\t{node.closed && (<span className={styles.closedState}>Voting closed -&nbsp;</span>)}\r\n\t\t\t\t<span className={styles.count}>{getVoterCountText(node.voterCount)}</span>\r\n\t\t\t\t<span className={styles.date}>{formatDate(new Date(node.createdTime))}</span>\r\n\t\t\t</div>\r\n\t\t\t<div className={cx('body', { open: !node.closed })}>\r\n\t\t\t\t<table className={styles.table}>\r\n\t\t\t\t\t<tbody>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th/>\r\n\t\t\t\t\t\t<th className={styles.countHeader}>Votes</th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t{availableChoices.concat(crossedOutChoices).map((choice) => {\r\n\t\t\t\t\t\treturn (<Choice\r\n\t\t\t\t\t\t\tkey={choice.choiceId}\r\n\t\t\t\t\t\t\tchoice={choice}\r\n\t\t\t\t\t\t\tchoiceNodeId={node.id}\r\n\t\t\t\t\t\t\tstartsSelected={'unselected'}\r\n\t\t\t\t\t\t/>);\r\n\t\t\t\t\t})}\r\n\t\t\t\t\t</tbody>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport './ReaderPostNode.css';\r\nimport formatDate from '../utils/formatDate.js';\r\n\r\nfunction Dice({ dice, vote }) {\r\n\treturn (\r\n\t\t<div className=\"entry\">\r\n\t\t\t<div dangerouslySetInnerHTML={{ __html: dice }}/>\r\n\t\t\t{vote && (<div dangerouslySetInnerHTML={{ __html: vote }}/>)}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction Vote({ vote }) {\r\n\treturn (\r\n\t\t<div className=\"entry\">\r\n\t\t\t<div dangerouslySetInnerHTML={{ __html: vote }}/>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default function ReaderPostNode({ node }) {\r\n\tconst diceRollerIds = node.dice && Object.keys(node.dice);\r\n\tconst voterIds = node.votes && Object.keys(node.votes);\r\n\tconst uniqueIds = _.uniq(diceRollerIds, voterIds);\r\n\tconst postCount = uniqueIds.length;\r\n\tlet postCountText;\r\n\tif (postCount > 1) {\r\n\t\tpostCountText = `${postCount} posts`;\r\n\t} else if (postCount === 1) {\r\n\t\tpostCountText = `1 post`;\r\n\t} else {\r\n\t\tpostCountText = `be the first to post.`;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"reader-post-node\">\r\n\t\t\t<div className=\"header\">\r\n\t\t\t\t<span className=\"title\">Reader Posts -&nbsp;</span>\r\n\t\t\t\t{node.closed && (<span className=\"closed-state\">Closed -&nbsp;</span>)}\r\n\t\t\t\t<span className=\"count\">{postCountText}</span>\r\n\t\t\t\t<span className=\"date\">{formatDate(new Date(node.createdTime))}</span>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"body\">\r\n\t\t\t\t{node.dice && <div className=\"dice\">{\r\n\t\t\t\t\tdiceRollerIds.map((diceRollerId) => {\r\n\t\t\t\t\t\treturn (<Dice\r\n\t\t\t\t\t\t\tkey={diceRollerId}\r\n\t\t\t\t\t\t\tdice={node.dice[diceRollerId]}\r\n\t\t\t\t\t\t\tvote={node.votes && node.votes[diceRollerId]}\r\n\t\t\t\t\t\t/>);\r\n\t\t\t\t\t})\r\n\t\t\t\t}</div>}\r\n\t\t\t\t{node.votes && <div className=\"votes\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvoterIds.filter((voterId) => {\r\n\t\t\t\t\t\t\treturn !diceRollerIds.includes(voterId);\r\n\t\t\t\t\t\t}).map((voterId) => {\r\n\t\t\t\t\t\t\treturn (<Vote key={voterId} vote={node.votes[voterId]}/>);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React from 'react';\r\nimport './TagList.css';\r\n\r\nexport default function TagList({ tags, spoilerTags }) {\r\n\treturn (\r\n\t\t<div className=\"tag-list\">\r\n\t\t\t<span className=\"label\">TAGS:</span>\r\n\t\t\t{tags && tags.map((tag) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<span\r\n\t\t\t\t\t\tclassName={`tag ${spoilerTags.includes(tag) ? 'spoiler' : ''}`}\r\n\t\t\t\t\t\tkey={tag}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{tag}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t);\r\n\t\t\t})}\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React from 'react';\r\nimport formatImageUrl from '../utils/formatImageUrl.js';\r\nimport './StoryHeader.css';\r\nimport TagList from './TagList.jsx';\r\n\r\nfunction Author({ user }) {\r\n\tconst avatarUrl = user.a && formatImageUrl(user.a, { width: 32, height: 32 });\r\n\treturn (<div className=\"author\">\r\n\t\t<a href={`https://fiction.live/user/${user.n}`}>\r\n\t\t\t{avatarUrl ? (<img alt=\"\" className=\"avatar\" src={avatarUrl}/>) : null}\r\n\t\t\t<span className=\"username\">{user.n}</span>\r\n\t\t</a>\r\n\t</div>);\r\n}\r\n\r\nexport default function StoryHeader({ metaData }) {\r\n\t// const {\r\n\t// \tta, // tags\r\n\t// \tspoilerTags,\r\n\t// \tu, // Array of authors\r\n\t// \tstoryStatus, // active/hiatus/finished\r\n\t// \tcontentRating, // age rating\r\n\t// \ti, // cover image\r\n\t// \tisLive,\r\n\t// \tnextLive\r\n\t// } = metaData;\r\n\tlet coverUrl = null;\r\n\tif (Array.isArray(metaData.i)) {\r\n\t\tcoverUrl = metaData.i[0];\r\n\t} else if (metaData.i) {\r\n\t\tcoverUrl = metaData.i;\r\n\t}\r\n\tif (coverUrl) {\r\n\t\tcoverUrl = formatImageUrl(coverUrl);\r\n\t}\r\n\treturn (\r\n\t\t<div className=\"story-header\">\r\n\t\t\t<h1 className=\"title\" dangerouslySetInnerHTML={{ __html: metaData.t }}/>\r\n\t\t\t{coverUrl && <img alt=\"\" className=\"cover\" src={coverUrl} key={coverUrl}/>}\r\n\t\t\t<div className=\"authors\">{\r\n\t\t\t\tmetaData.u.filter((user) => user.n).map((user) => {\r\n\t\t\t\t\treturn (<Author key={user.n} user={user}/>)\r\n\t\t\t\t})\r\n\t\t\t}</div>\r\n\t\t\t<TagList tags={metaData.ta} spoilerTags={metaData.spoilerTags}/>\r\n\t\t\t{metaData.d && <div className=\"description\" dangerouslySetInnerHTML={{ __html: metaData.d }}/>}\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, {useEffect, useState} from 'react';\r\nimport ChapterNode from './ChapterNode.jsx';\r\nimport ChoiceNode from './ChoiceNode.jsx';\r\nimport ReaderPostNode from './ReaderPostNode.jsx';\r\nimport './Story.css';\r\nimport StoryHeader from './StoryHeader.jsx';\r\n\r\nexport default function Story({ client }) {\r\n\tconst [nodes, setNodes] = useState(client.storyThread.history.nodes);\r\n\tconst [metaData, setMetaData] = useState(client.storyThread.metaData);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst onChapter = () => {\r\n\t\t\tsetNodes(client.storyThread.history.nodes.slice());\r\n\t\t};\r\n\t\tconst onChapterUpdated = () => {\r\n\t\t\tsetNodes(client.storyThread.history.nodes.slice());\r\n\t\t};\r\n\t\tconst onChoice = () => {\r\n\t\t\tsetNodes(client.storyThread.history.nodes.slice());\r\n\t\t};\r\n\t\tconst onChoiceUpdated = () => {\r\n\t\t\tsetNodes(client.storyThread.history.nodes.slice());\r\n\t\t};\r\n\t\tconst onReaderPost = () => {\r\n\t\t\tsetNodes(client.storyThread.history.nodes.slice());\r\n\t\t};\r\n\t\tconst onReaderPostUpdated = () => {\r\n\t\t\tsetNodes(client.storyThread.history.nodes.slice());\r\n\t\t};\r\n\t\tconst onMetaData = (metaData) => {\r\n\t\t\tsetMetaData(metaData);\r\n\t\t};\r\n\r\n\t\tclient.storyThread.on('chapter', onChapter);\r\n\t\tclient.storyThread.on('chapterUpdated', onChapterUpdated);\r\n\t\tclient.storyThread.on('choice', onChoice);\r\n\t\tclient.storyThread.on('choiceUpdated', onChoiceUpdated);\r\n\t\tclient.storyThread.on('readerPost', onReaderPost);\r\n\t\tclient.storyThread.on('readerPostUpdated', onReaderPostUpdated);\r\n\t\tclient.storyThread.on('metaData', onMetaData);\r\n\r\n\t\tsetNodes(client.storyThread.history.nodes.slice());\r\n\t\tsetMetaData(client.storyThread.metaData);\r\n\t\treturn () => {\r\n\t\t\tclient.storyThread.off('chapter', onChapter);\r\n\t\t\tclient.storyThread.off('chapterUpdated', onChapterUpdated);\r\n\t\t\tclient.storyThread.off('choice', onChoice);\r\n\t\t\tclient.storyThread.off('choiceUpdated', onChoiceUpdated);\r\n\t\t\tclient.storyThread.off('readerPost', onReaderPost);\r\n\t\t\tclient.storyThread.off('readerPostUpdated', onReaderPostUpdated);\r\n\t\t\tclient.storyThread.off('metaData', onMetaData);\r\n\t\t}\r\n\t}, [client]);\r\n\r\n\tlet unrecognisedKey = 0;\r\n\treturn (\r\n\t\t<div className=\"story\">\r\n\t\t\t<StoryHeader metaData={metaData}/>\r\n\t\t\t<div className=\"history\">\r\n\t\t\t\t{nodes.map((node) => {\r\n\t\t\t\t\tswitch (node.type) {\r\n\t\t\t\t\t\tcase 'chapter':\r\n\t\t\t\t\t\t\treturn (<ChapterNode key={node.id} node={node}/>);\r\n\t\t\t\t\t\tcase 'choice':\r\n\t\t\t\t\t\t\treturn (<ChoiceNode key={node.id} node={node}/>);\r\n\t\t\t\t\t\tcase 'readerPost':\r\n\t\t\t\t\t\t\treturn (<ReaderPostNode key={node.id} node={node}/>);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\treturn (<div key={unrecognisedKey++}>Unrecognised node type: {node.type}</div>);\r\n\t\t\t\t\t}\r\n\t\t\t\t})}\r\n\t\t\t\t<div className=\"footer\"/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React from 'react';\r\nimport './StoryControls.css';\r\n\r\nexport default function StoryControls(props) {\r\n\treturn (\r\n\t\t<div className=\"story-controls\">\r\n\t\t\t<div>Live Timer</div>\r\n\t\t\t<div>Reviews</div>\r\n\t\t\t<div>Follow</div>\r\n\t\t\t<div>Pick chapter</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React from 'react';\r\nimport Chat from '../chat/Chat.jsx';\r\nimport Story from './Story.jsx';\r\nimport StoryControls from './StoryControls.jsx';\r\nimport './StoryView.css';\r\n\r\nexport default function StoryView({ client }) {\r\n\treturn (\r\n\t\t<div className=\"story-view\">\r\n\t\t\t<StoryControls/>\r\n\t\t\t<Story\r\n\t\t\t\tclient={client}\r\n\t\t\t/>\r\n\t\t\t<Chat client={client}/>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React from 'react';\nimport akun from './akun.js';\nimport './App.css';\nimport LoadingScreen from './LoadingScreen.jsx';\nimport NavBar from './navBar/NavBar.jsx';\nimport StoryView from './story/StoryView.jsx';\n\nexport default class App extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tinitPhase: true,\n\t\t\tclient: null,\n\t\t\tclientChatFreshEntry: false,\n\t\t\tliveStories: []\n\t\t};\n\n\t\tthis.init();\n\t}\n\n\tasync init() {\n\t\tawait Promise.all([\n\t\t\takun.ephemeralUserIdPromise,\n\t\t\tthis.joinPinnedStories()\n\t\t]);\n\t\tawait Promise.all([\n\t\t\tthis.showStory('vhHhMfskRnNDbxwzo'),\n\t\t\tawait this.updateLiveStories()\n\t\t]);\n\t\tthis.setState({ initPhase: false });\n\t}\n\n\tasync joinPinnedStories() {\n\t\t// Use live instead of pinned for now\n\t\tconst { stories } = await akun.getStories('live', null);\n\t\treturn stories.map((story) => {\n\t\t\treturn akun.join(story._id);\n\t\t})\n\t}\n\n\tasync updateLiveStories() {\n\t\tconst { stories } = await akun.getStories('live', null);\n\t\tthis.setState({ liveStories: stories });\n\t\t// setTimeout(() => {\n\t\t// \tthis.updateLiveStories();\n\t\t// }, 30000);\n\t}\n\n\tasync showStory(id) {\n\t\tconst client = await akun.join(id);\n\t\tthis.setState({ client });\n\t}\n\n\trender() {\n\t\tif (this.state.initPhase) {\n\t\t\treturn (<LoadingScreen/>);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<div className=\"App\">\n\t\t\t\t\t<NavBar\n\t\t\t\t\t\tliveStories={this.state.liveStories}\n\t\t\t\t\t\tshowStory={this.showStory.bind(this)}\n\t\t\t\t\t/>\n\t\t\t\t\t{this.state.client ? (<StoryView client={this.state.client}/>) : (<div>Nothing to see here</div>)}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t}\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App.jsx';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}